<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch·ªçn h√†nh l√Ω v√† su·∫•t ƒÉn - Bamboo Airways</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }

        .header {
            background-color: #fff;
            padding: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #00693E;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .flight-info {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .flight-info h3 {
            color: #00693E;
            margin-bottom: 10px;
        }

        .title {
            text-align: center;
            margin-bottom: 30px;
        }

        .title h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .title p {
            color: #666;
            font-size: 16px;
        }

        .section {
            background-color: #fff;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #00693E;
        }

        .service-items {
            display: grid;
            gap: 20px;
        }

        .service-item {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .service-item:hover {
            border-color: #00693E;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .service-item.selected {
            border-color: #00693E;
            background-color: #E8F5F1;
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .service-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .service-price {
            font-size: 18px;
            font-weight: bold;
            color: #00693E;
        }

        .service-description {
            color: #666;
            margin-bottom: 15px;
        }

        .service-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .quantity-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #00693E;
            background-color: #fff;
            color: #00693E;
            border-radius: 4px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quantity-btn:hover {
            background-color: #00693E;
            color: #fff;
        }

        .quantity-btn:disabled {
            border-color: #ccc;
            color: #ccc;
            cursor: not-allowed;
        }

        .quantity-btn:disabled:hover {
            background-color: #fff;
            color: #ccc;
        }

        .quantity-display {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            min-width: 40px;
            text-align: center;
        }

        .add-service-btn {
            padding: 10px 25px;
            background-color: #00693E;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-service-btn:hover {
            background-color: #005030;
        }

        .price-summary {
            background-color: #E8F5F1;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ccc;
        }

        .price-row:last-child {
            border-bottom: none;
            font-size: 20px;
            font-weight: bold;
            color: #00693E;
            padding-top: 15px;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background-color: #00693E;
            color: white;
        }

        .btn-primary:hover {
            background-color: #005030;
        }

        .btn-secondary {
            background-color: #fff;
            color: #00693E;
            border: 2px solid #00693E;
        }

        .btn-secondary:hover {
            background-color: #f0f0f0;
        }

        .passenger-label {
            color: #00693E;
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">üõ´ BAMBOO AIRWAYS</div>
            <div>L·ª±a ch·ªçn m√≥n</div>
        </div>
    </div>

    <div class="container">
        <div class="flight-info">
            <h3>Th√¥ng tin chuy·∫øn bay</h3>
            <p>M√£ chuy·∫øn bay: <strong th:text="${flightId}">FL001</strong></p>
            <p>S·ªë h√†nh kh√°ch: <strong th:text="${passengerCount}">1</strong></p>
            <p th:if="${selectedSeats != null and !selectedSeats.isEmpty()}">
                Gh·∫ø ƒë√£ ch·ªçn: <strong th:text="${selectedSeats}">-</strong>
            </p>
        </div>

        <div class="title">
            <h1>L·ª±a ch·ªçn m√≥n</h1>
            <p>Su·∫•t ƒÉn: TP. H·ªì Ch√≠ Minh - H√† N·ªôi</p>
        </div>

        <!-- Baggage Section -->
        <div class="section">
            <h2 class="section-title">üß≥ H√†nh L√Ω K√Ω G·ª≠i</h2>
            <div class="passenger-label" th:text="'√îng Nguyen Bao (' + ${passengerCount} + ' h√†nh kh√°ch)'">
                √îng Nguyen Bao
            </div>
            <div class="service-items">
                <div class="service-item" th:each="baggage : ${baggageOptions}"
                     th:data-id="${baggage.id}"
                     th:data-price="${baggage.price}"
                     th:data-type="baggage">
                    <div class="service-header">
                        <div class="service-name" th:text="${baggage.name}">H√†nh L√Ω 15kg</div>
                        <div class="service-price">
                            <span th:text="${#numbers.formatDecimal(baggage.price, 0, 'COMMA', 0, 'POINT')}">200,000</span> VND
                        </div>
                    </div>
                    <div class="service-description" th:text="${baggage.description}">
                        H√†nh l√Ω k√Ω g·ª≠i 15kg
                    </div>
                    <div class="service-actions">
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="decreaseQuantity(this)">‚àí</button>
                            <div class="quantity-display">0</div>
                            <button class="quantity-btn" onclick="increaseQuantity(this)">+</button>
                        </div>
                        <div class="add-service-btn" style="visibility: hidden;">
                            Th√™m m·ªôt d·ªãch v·ª• n·ªØa cho <span th:text="${#numbers.formatDecimal(baggage.price, 0, 'COMMA', 0, 'POINT')}">80,000</span> VND
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Meal Section -->
        <div class="section">
            <h2 class="section-title">üç± Su·∫•t ƒÇn</h2>
            <div class="passenger-label" th:text="'√îng Nguyen Bao (' + ${passengerCount} + ' h√†nh kh√°ch)'">
                √îng Nguyen Bao
            </div>
            <div class="service-items">
                <div class="service-item" th:each="meal : ${mealOptions}"
                     th:data-id="${meal.id}"
                     th:data-price="${meal.price}"
                     th:data-type="meal">
                    <div class="service-header">
                        <div class="service-name" th:text="${meal.name}">X√¥i Th·ªãt Kho Tr·ª©ng</div>
                        <div class="service-price">
                            1 d·ªãch v·ª• <span th:text="${#numbers.formatDecimal(meal.price, 0, 'COMMA', 0, 'POINT')}">80,000</span> VND
                        </div>
                    </div>
                    <div class="service-description" th:text="${meal.description}">
                        X√¥i th·ªãt kho tr·ª©ng truy·ªÅn th·ªëng
                    </div>
                    <div class="service-actions">
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="decreaseQuantity(this)">‚àí</button>
                            <div class="quantity-display">0</div>
                            <button class="quantity-btn" onclick="increaseQuantity(this)">+</button>
                        </div>
                        <div class="add-service-btn" style="visibility: hidden;">
                            Th√™m m·ªôt d·ªãch v·ª• n·ªØa cho <span th:text="${#numbers.formatDecimal(meal.price, 0, 'COMMA', 0, 'POINT')}">80,000</span> VND
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Price Summary -->
        <div class="price-summary">
            <div class="price-row">
                <span>T·ªïng ti·ªÅn d·ªãch v·ª• b·ªï sung:</span>
                <span id="servicesTotal">0 VND</span>
            </div>
            <div class="price-row">
                <span>T·ªïng c·ªông:</span>
                <span id="grandTotal">0 VND</span>
            </div>
        </div>

        <div class="action-buttons">
            <a th:href="@{/booking/services/seats(flightId=${flightId},passengers=${passengerCount})}"
               class="btn btn-secondary">Quay l·∫°i</a>
            <button class="btn btn-primary" onclick="confirmSelection()">
                X√°c nh·∫≠n v√† ti·∫øp t·ª•c
            </button>
        </div>
    </div>

    <script th:inline="javascript">
        const flightId = /*[[${flightId}]]*/ 'FL001';
        const passengerCount = /*[[${passengerCount}]]*/ 1;
        const selectedSeats = /*[[${selectedSeats}]]*/ '';

        function increaseQuantity(btn) {
            const item = btn.closest('.service-item');
            const display = item.querySelector('.quantity-display');
            let quantity = parseInt(display.textContent);

            if (quantity < passengerCount) {
                quantity++;
                display.textContent = quantity;

                if (quantity > 0) {
                    item.classList.add('selected');
                    const addBtn = item.querySelector('.add-service-btn');
                    if (quantity < passengerCount) {
                        addBtn.style.visibility = 'visible';
                    } else {
                        addBtn.style.visibility = 'hidden';
                    }
                }

                updatePricing();
            }
        }

        function decreaseQuantity(btn) {
            const item = btn.closest('.service-item');
            const display = item.querySelector('.quantity-display');
            let quantity = parseInt(display.textContent);

            if (quantity > 0) {
                quantity--;
                display.textContent = quantity;

                if (quantity === 0) {
                    item.classList.remove('selected');
                    item.querySelector('.add-service-btn').style.visibility = 'hidden';
                } else {
                    item.querySelector('.add-service-btn').style.visibility = 'visible';
                }

                updatePricing();
            }
        }

        function updatePricing() {
            let total = 0;

            document.querySelectorAll('.service-item').forEach(item => {
                const quantity = parseInt(item.querySelector('.quantity-display').textContent);
                const price = parseFloat(item.dataset.price);
                total += quantity * price;
            });

            document.getElementById('servicesTotal').textContent =
                formatCurrency(total) + ' VND';
            document.getElementById('grandTotal').textContent =
                formatCurrency(total) + ' VND';
        }

        function formatCurrency(amount) {
            return amount.toLocaleString('vi-VN');
        }

        function confirmSelection() {
            const selectedItems = [];

            document.querySelectorAll('.service-item').forEach(item => {
                const quantity = parseInt(item.querySelector('.quantity-display').textContent);
                if (quantity > 0) {
                    selectedItems.push({
                        id: item.dataset.id,
                        type: item.dataset.type,
                        quantity: quantity,
                        price: parseFloat(item.dataset.price)
                    });
                }
            });

            if (selectedItems.length === 0) {
                if (confirm('B·∫°n ch∆∞a ch·ªçn d·ªãch v·ª• n√†o. B·∫°n c√≥ mu·ªën ti·∫øp t·ª•c kh√¥ng?')) {
                    alert('Chuy·ªÉn ƒë·∫øn trang thanh to√°n');
                    // window.location.href = '/booking/payment?flightId=' + flightId;
                }
            } else {
                console.log('Selected services:', selectedItems);
                alert('ƒê√£ ch·ªçn ' + selectedItems.length + ' d·ªãch v·ª•. Chuy·ªÉn ƒë·∫øn trang thanh to√°n.');
                // window.location.href = '/booking/payment?flightId=' + flightId + '&services=' + JSON.stringify(selectedItems);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updatePricing();
        });
    </script>
</body>
</html>

